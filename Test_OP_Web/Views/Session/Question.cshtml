@model Test_OP_Web.Data.SessionQuestion
@{

}

<h1>Тест огневая подготовка. Вариант @Model.Question.NumVar</h1>


<a class="btn btn-secondary" asp-controller="Session" asp-action="Session" asp-route-Id="@Model.SessionId">Просмотр сессии</a>
<a class="btn btn-success justify-content-end" asp-controller="Session" asp-action="Complete" asp-route-SessionId="@Model.SessionId">Закончить сессию</a>

<hr />

<div>

    <form id="qusetionForm" asp-controller="Session" asp-action="Question" method="post">
        <h3>@Model.Question.QuestionString</h3>

        <hr />

        <div class="question btn btn-light w-100">
            <input class="question-input" type="radio" value="1" asp-for="Enter" />
            <span class="text-body">@Model.Question.One</span>


            <br />
        </div>


        <div class="question btn btn-light w-100">
            <input class="question-input" type="radio" value="2" asp-for="Enter" />

            <span class="text">@Model.Question.Two</span>

            <br />
        </div>


        <div class="question btn btn-light w-100">
            <input class="question-input" type="radio" value="3" asp-for="Enter" />

            <span class="">@Model.Question.Three</span>

            <br />

        </div>

        <div class="question btn btn-light w-100">
            <input class="question-input" type="radio" value="4" asp-for="Enter" />

            <span class="">@Model.Question.Four</span>

            <br />
        </div>
        <hr />
        @*<input  class="btn btn-warning submit-question" type="submit" value="Сохранить" />*@
        @*<span class="notsaved">Сохранено</span>
        <br />*@

        @if (Model.NumQ != 1)
        {
            <a class="btn btn-dark" asp-controller="Session" asp-action="Question" asp-route-SessionId="@Model.SessionId" asp-route-NumQ="@(Model.NumQ-1)" asp->Предыдущий вопрос</a>
        }
        <a class="btn btn-primary" asp-controller="Session" asp-action="Question" asp-route-SessionId="@Model.SessionId" asp-route-NumQ="@(Model.NumQ+1)">Следующий вопрос</a>




        @Html.Hidden("SessionId", Model.SessionId)
        @Html.Hidden("NumQ", Model.NumQ)
    </form>


</div>


<style type="text/css">
    .notsaved {
        opacity: 0;
        color: gray;
    }

    .saved {
        opacity: 100;
        color: gray;
    }
</style>


<script type="text/javascript">


    let elements = document.querySelectorAll(".question");

    function clearClasses() {

        for (var i = 0; i < 4; i++) {
            const k = i;
            elements[k].classList.remove("btn-primary");
            elements[k].classList.add("btn-light");

            if (elements[k].childNodes[1].checked == true) {
                elements[k].classList.add("btn-primary");
                elements[k].classList.remove("btn-light");
            }
                

            
        }

    }

    clearClasses();

    for (var i = 0; i < 4; i++) {
        const k = i;
        elements[k].onclick = function () {

            
            elements[k].childNodes[1].checked = true;
            clearClasses();
            submitQuestion();

        };
    }


    function submitQuestion() {


        var data = $("#qusetionForm").serialize();
        console.log(data);
        //alert(data);
        $.ajax({
            type: 'POST',
            url: '/Session/Question',
            contentType: 'application/x-www-form-urlencoded; charset=UTF-8', // when we use .serialize() this generates the data in query string format. this needs the default contentType (default content type is: contentType: 'application/x-www-form-urlencoded; charset=UTF-8') so it is optional, you can remove it
            data: data,
            success: function (result) {

                $(".notsaved").removeClass("notsaved");
                $(".notsaved").addClass("saved");
                //alert('Successfully received Data ');
                console.log(result);
            },
            error: function () {
                alert('Failed to receive the Data');
                console.log('Failed ');
            }
        })
    }

</script>